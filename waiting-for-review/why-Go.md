# Go的魅力

## devops工程师如何对待Go

到目前为止,大多数devops工具都是用Go写的.
docker,kubernetes,terraform(一个devops工具),
vault(敏感信息访问工具),prometheus,helm,loki,grafana,
都是用Go写的.

高效,易复用,简单,健壮都是Go的特点.

## trivago全面使用Go

trivago是一个酒店软件,他们遇到以下问题

### 竞争检测

并发高,请求的超时管理和共享资源的管理称为难题.

Go中的超时,取消,上下文机制和并发,正好能解决这些问题.

有时候出现竞争是因为某些函数不是可重入的,或者说这块没设计好,
加锁又会导致整个系统的性能下降.

Go官方提供了工具,添加构建参数 -race就可以做竞争检测了.

### 二进制文件是静态链接的

编译Go程序时,不需要解释器或虚拟机,
如果不适用cgo,那么发布就一个文件,很简单了.
如果再配合docker,只用一步就可以搞定所有流程,
甚至连docker的alpine或debian的slim版本都不用,
直接使用空镜像scratch更加简洁.这样最后的docker镜像就更小了.

## 78年开始编程的教授的说法

C转java,再转Go,教学用python.

### 极简主义

语言简单,50页的spec.

- 测试和性能是内置框架提供,简单易学功能强大
- 通过一个http服务就可以调试和测试性能
- 文档自动生成,测试例子也是如此
- 强类型,静态类型,无隐式转换,这些开销很小
  - 导致类型安全比java强,写法倒是类似python
- 包做隔离,依赖管理强
- 接口通过动态调度,提供运行时多态
- 天生支持并发:协程/信道/select语句

### 和现代语言做比较

有些东西是没有添加到Go中的

- 包管理(ps:从v1.11开始就添加了module)
- 泛型,v2.0会提供
- 错误处理(ps:v1.14就开始对错误处理有改动)

### 和java做比较

java spec有750页,
generic出现了280次,enum出现了241次.

### 兼容性

Go1的代码现在依旧能用.

### 性能

- 语言/运行时/标准库对性能影响很大
- Go是编译型,是静态链接型,只有一个可执行,可直接部署
- 代码生成的大小和速度
- 自带gc,而且gc延时低
- 标准库高质量,eg:正则.(java/python的标准库不一定是质量高的)
- 构建速度

## 从java到Go

这个是7周7种语言系列的第二弹,Go.

- 简单易学
  - 学完tour就可以开始动手慢慢写了
  - spec 小于100页
- 工具丰富,安装完之后就可以使用
  - go get 获取包
  - go fmt 格式化
  - go build 编译
  - go run 运行
  - 分析
  - 离线搜索和阅读 go doc

switch语句中的fallthrough和break正好相反.
switch可以带条件,也可以不带条件(此时相当于if else if).

信道在多协程中通信,叫csp(communicating sequential processes).

### 不好的地方

- 错误处理,这个Go已经开始修改了.
- 指针,和c++中的有些不一致,不好理解.
- make/new/New
- 编译器太严格,对于未用到的变量和包,有的支持,有的不支持
- runes表示字符,并没有强大的用处
- 初始化可以放在if中(c++也能这么玩)
- for的用法包含了while
- 短声明和正常声明重复(这点还好)
- 包引用时,只用最后的包名,如果存在两个同名包名,就需要用别名
- 没有类,但结构体和接口还是非常强大的,支持oop
