# Go的魅力

## devops工程师如何对待Go

到目前为止,大多数devops工具都是用Go写的.
docker,kubernetes,terraform(一个devops工具),
vault(敏感信息访问工具),prometheus,helm,loki,grafana,
都是用Go写的.

高效,易复用,简单,健壮都是Go的特点.

## trivago全面使用Go

trivago是一个酒店软件,他们遇到以下问题

### 竞争检测

并发高,请求的超时管理和共享资源的管理称为难题.

Go中的超时,取消,上下文机制和并发,正好能解决这些问题.

有时候出现竞争是因为某些函数不是可重入的,或者说这块没设计好,
加锁又会导致整个系统的性能下降.

Go官方提供了工具,添加构建参数 -race就可以做竞争检测了.

### 二进制文件是静态链接的

编译Go程序时,不需要解释器或虚拟机,
如果不适用cgo,那么发布就一个文件,很简单了.
如果再配合docker,只用一步就可以搞定所有流程,
甚至连docker的alpine或debian的slim版本都不用,
直接使用空镜像scratch更加简洁.这样最后的docker镜像就更小了.
体积是方面,更重要的是启动速度会很快.

更小的体积和更快的启动速度,对于k8s的自动伸缩特别重要.

go fmt解决了一些编码风格上的争议.

微服务支持好.

## 78年开始编程的教授的说法

C转java,再转Go,教学用python.

### 极简主义

语言简单,50页的spec.

- 测试和性能是内置框架提供,简单易学功能强大
- 通过一个http服务就可以调试和测试性能
- 文档自动生成,测试例子也是如此
- 强类型,静态类型,无隐式转换,这些开销很小
  - 导致类型安全比java强,写法倒是类似python
- 包做隔离,依赖管理强
- 接口通过动态调度,提供运行时多态
- 天生支持并发:协程/信道/select语句

### 和现代语言做比较

有些东西是没有添加到Go中的

- 包管理(ps:从v1.11开始就添加了module)
- 泛型,v2.0会提供
- 错误处理(ps:v1.14就开始对错误处理有改动)

### 和java做比较

java spec有750页,
generic出现了280次,enum出现了241次.

### 兼容性

Go1的代码现在依旧能用.

### 性能

- 语言/运行时/标准库对性能影响很大
- Go是编译型,是静态链接型,只有一个可执行,可直接部署
- 代码生成的大小和速度
- 自带gc,而且gc延时低
- 标准库高质量,eg:正则.(java/python的标准库不一定是质量高的)
- 构建速度

## 从java到Go

这个是7周7种语言系列的第二弹,Go.

- 简单易学
  - 学完tour就可以开始动手慢慢写了
  - spec 小于100页
- 工具丰富,安装完之后就可以使用
  - go get 获取包
  - go fmt 格式化
  - go build 编译
  - go run 运行
  - 分析
  - 离线搜索和阅读 go doc

switch语句中的fallthrough和break正好相反.
switch可以带条件,也可以不带条件(此时相当于if else if).

信道在多协程中通信,叫csp(communicating sequential processes).

### 不好的地方

- 错误处理,这个Go已经开始修改了.
- 指针,和c++中的有些不一致,不好理解.
- make/new/New
- 编译器太严格,对于未用到的变量和包,有的支持,有的不支持
- runes表示字符,并没有强大的用处
- 初始化可以放在if中(c++也能这么玩)
- for的用法包含了while
- 短声明和正常声明重复(这点还好)
- 包引用时,只用最后的包名,如果存在两个同名包名,就需要用别名
- 没有类,但结构体和接口还是非常强大的,支持oop

## scala 到Go

这是一家做终端安全的公司,以前主流技术栈是scala.

在机器学习和机器分析的技术栈中,scala占据了大块江山.
交互可以和java操作,dsl可以用于分析.

当开发人员从5个涨到200以上时,故事才刚刚开始.
代码基线维护成了问题.
有个开发人员的代码出了问题,但人在度假,其他开发人员
不得不花费数小时来解决这个问题(其实这个问题是个小问题).

主要原因是每个人都可以很灵活的选择实现方式,
灵活也是有代价的,好在这种代价在checklist和review
中是可以提前解决的.

但人员的增长带来的问题也不可忽视,开发环境/构建环境/依赖版本...,
以投资的眼光来看,这是一个问题.

twitter也遇到了同样的问题,其他公司也遇到了,
甚至使用scala的增长型公司都与到了这个问题,
基本上超过50个scala开发者时,问题就来了.
yammer/linkedin/twitter都开始选择避免scala.

至少Go在这块解决的不错.

- 构建速度快,更小的二进制文件,单文件,格式,工具,内置测试框架
- 竞争检测,可视化性能分析,并发模型

慢慢慢慢,一个个项目被替换成Go,至少从可维护性来看,Go做的不错.
交付更快,更稳定,更大的测试覆盖率.

其次,招聘的范围扩大了,不管以前做什么语言,转Go很简单.

对于写高性能的服务,Go很顺手.
